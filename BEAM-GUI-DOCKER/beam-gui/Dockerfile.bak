FROM dorowu/ubuntu-desktop-lxde-vnc:focal
# Base: Ubuntu + lightweight desktop + web VNC at :6080

USER root

# --- FIX: remove broken Google Chrome repo to avoid GPG error ---
RUN rm -f /etc/apt/sources.list.d/google-chrome.list || true \
    && rm -f /etc/apt/trusted.gpg.d/google-chrome.gpg || true
# ----------------------------------------------------------------

RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 python3-pip python3-tk python3-dev build-essential \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /opt/app
COPY requirements.txt /opt/app/requirements.txt
RUN pip3 install --no-cache-dir -r requirements.txt || true

COPY . /opt/app

COPY start.sh /usr/local/bin/start_app.sh
RUN chmod +x /usr/local/bin/start_app.sh

EXPOSE 6080 5901
CMD ["/usr/local/bin/start_app.sh"]
